from universalclassifier.experiment_planning import plan_and_preprocess


def parse_args():
    import argparse
    parser = argparse.ArgumentParser()
    parser.add_argument("--train", type=bool, default=False, help="Whether or not to run in training mode")
    parser.add_argument("-t", "--task_ids", nargs="+",
                        help="List of integers belonging to the task ids you wish to run"
                             " experiment planning and preprocessing for. Each of these "
                             "ids must, have a matching folder 'TaskXXX_' in the raw "
                             "data folder")
    parser.add_argument("-pl3d", "--planner3d", type=str, default="ClassificationRegressionExperimentPlanner3D",
                        help="Name of the ExperimentPlanner class. Default is ClassificationExperimentPlanner3D.")
    parser.add_argument("-pl2d", "--planner2d", type=str, default="None",
                        help="Not implemented")
    parser.add_argument("-no_pp", action="store_true",
                        help="Set this flag if you dont want to run the preprocessing. If this is set then this script "
                             "will only run the experiment planning and create the plans file")
    parser.add_argument("-tl", type=int, required=False, default=8,
                        help="Number of processes used for preprocessing the low resolution data for the 3D low "
                             "resolution U-Net. This can be larger than -tf. Don't overdo it or you will run out of "
                             "RAM")
    parser.add_argument("-tf", type=int, required=False, default=8,
                        help="Number of processes used for preprocessing the full resolution data of the 2D U-Net and "
                             "3D U-Net. Don't overdo it or you will run out of RAM")
    parser.add_argument("--verify_dataset_integrity", required=False, default=False, action="store_true",
                        help="Not implmented yet for universal classifier. Set this flag to check the dataset "
                             "integrity. This is useful and should be done once for each dataset!")
    parser.add_argument("-overwrite_plans", type=str, default=None, required=False,
                        help="Use this to specify a plans file that should be used instead of whatever nnU-Net would "
                             "configure automatically. This will overwrite everything: intensity normalization, "
                             "network architecture, target spacing etc. Using this is useful for using pretrained "
                             "model weights as this will guarantee that the network architecture on the target "
                             "dataset is the same as on the source dataset and the weights can therefore be transferred.\n"
                             "Pro tip: If you want to pretrain on Hepaticvessel and apply the result to LiTS then use "
                             "the LiTS plans to run the preprocessing of the HepaticVessel task.\n"
                             "Make sure to only use plans files that were "
                             "generated with the same number of modalities as the target dataset (LiTS -> BCV or "
                             "LiTS -> Task008_HepaticVessel is OK. BraTS -> LiTS is not (BraTS has 4 input modalities, "
                             "LiTS has just one)). Also only do things that make sense. This functionality is beta with"
                             "no support given.\n"
                             "Note that this will first print the old plans (which are going to be overwritten) and "
                             "then the new ones (provided that -no_pp was NOT set).")
    parser.add_argument("-overwrite_plans_identifier", type=str, default=None, required=False,
                        help="If you set overwrite_plans you need to provide a unique identifier so that nnUNet knows "
                             "where to look for the correct plans and data. Assume your identifier is called "
                             "IDENTIFIER, the correct training command would be:\n"
                             "'nnUNet_train CONFIG TRAINER TASKID FOLD -p nnUNetPlans_pretrained_IDENTIFIER "
                             "-pretrained_weights FILENAME'")

    args = parser.parse_args()
    return args



if __name__ == "__main__":
    plan_and_preprocess.main(parse_args())
    print("Completed planning and preprocessing.")
